"use strict";!function(){angular.module("timeline",[]).controller("controller",["$scope","$http",function(e,t){var r=[];t({method:"GET",url:"timeline.json"}).then(function(n){e.events=[];for(var a=new AsyncTaskCounter(function(){r=JSON.parse(JSON.stringify(e.events))}),s=0;s<n.data.length;s++){var i=n.data[s],o={};o.date=new Date(i.date),o.title=i.title,o.text="Loading...",o.textUrl=i.text,o.hasGalery=!(""==i.galeryLink||""==i.thumbnail),o.galeryLink=i.galeryLink,o.thumbnail=i.thumbnail,a.incr(),function(e){t({method:"GET",url:"../admin/timeline/"+i.text}).then(function(t){e.text=t.data,a.decr()},function(t){e.text=t.statusText,a.decr()})}(o),e.events.push(o)}},function(t){e.error=!0}),e.saveEvents=function(){for(var n=[],a=JSON.parse(JSON.stringify(e.events)),s=0;s<a.length;s++){var i=a[s];i.text!=r[s].text&&n.push(JSON.parse(JSON.stringify(i))),i.hasGalery||(i.thumbnail="",i.galeryLink=""),i.text=i.textUrl,delete i.textUrl,delete i.hasGalery}console.log(a),console.log(n);try{t({method:"POST",url:"saveTimeline.php?ajax",data:{timeline:a,editedTexts:n,savefile:""}}).then(function(t){console.log(t),t.data.success?(e.saveError=!1,e.message="Saved"):(e.saveError=!0,e.message="Error: "+t.data.error)},function(t){e.saveError=!0,e.message="Error: "+t})}catch(t){e.saveError=!0,e.message="Error: "+t}}}])}();